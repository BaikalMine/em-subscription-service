# Сервис агрегации подписок

Это небольшой Go-сервис, который хранит записи о подписках пользователей, предоставляет полный набор CRUDL-операций и умеет считать суммарную стоимость активных подписок за заданный период. Все данные пишутся в PostgreSQL, документация описана в формате OpenAPI, а развернуть стек можно через `docker compose`.

## Как запустить

1. Скопируйте шаблон конфигурации:
   ```sh
   cp .env.example .env
   ```
2. Поднимите PostgreSQL и приложение одним `docker compose up --build`. Как только контейнеры стартуют, API будет доступно по адресу `http://localhost:${SERVER_PORT}` (по умолчанию `8080`).

Если вы предпочитаете запускать сервис напрямую из Go:

```sh
go run ./cmd/server
```

Он использует тот же `.env`, чтобы подключиться к базе.

## О чём нужно помнить

- Миграция `migrations/0001_create_subscriptions.sql` создаёт таблицу подписок и индексы, и при использовании Docker Compose автоматически выполняется во время первого запуска PostgreSQL.
- Swagger-спецификация лежит в `docs/swagger.yaml`, а сам YAML/статические файлы раздаются по `/swagger.yaml` и `/docs/` соответственно.
- API работает с ценами в рублях, без копеек — поле `price` принимает только целые значения.

## Кратко по маршрутам

- `POST /subscriptions` — создаёт новую подписку.
- `GET /subscriptions` — возвращает список подписок, можно отфильтровать по `user_id`, `service_name`, `limit`, `offset`.
- `GET /subscriptions/{id}` — получает одну запись.
- `PUT /subscriptions/{id}` — заменяет запись.
- `DELETE /subscriptions/{id}` — удаляет.
- `GET /subscriptions/summary` — суммирует цены подписок, которые пересекаются с заданным промежутком `start`/`end` в `MM-YYYY`; можно сузить выборку по `user_id` и `service_name`.

Ответы приходят в JSON, а ошибки возвращаются в виде `{"error":"..."}`.
